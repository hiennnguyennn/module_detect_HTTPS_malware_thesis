from scapy.all import *
import pandas as pd
import datetime
load_layer("tls")
ip_src=None
ip_dst=None
tmp=""
tmp+=str(pd.to_datetime(datetime.datetime.now(), format="%Y-%m-%d %H:%M:%S"))+" :Start replay pcap\n"
index_tmp=0
for pkt in PcapReader('/home/hiennnn/Downloads/2014-01-25_capture_win3.pcap'):
    print('read pkt')
    if IP in pkt:
        ip_src=pkt[IP].src
        ip_dst=pkt[IP].dst
    # if TCP in pkt:
    #     tcp_sport=pkt[TCP].sport
    #     tcp_dport=pkt[TCP].dport
    try:
        # sendp(pkt, iface="enp0s31f6")
        sendp(pkt)
    except Exception as e:
        tmp+="Exception "+str(pkt)+" : "+str(e)+" with lenght: "+str(len(pkt))+"\n"
tmp+=str(pd.to_datetime(datetime.datetime.now(), format="%Y-%m-%d %H:%M:%S"))+" :Done replay pcap\n"
f = open("/home/hiennnn/Documents/DATN/test_traffic/capture_test_before.txt", "w")
f.write(tmp)
f.close()
