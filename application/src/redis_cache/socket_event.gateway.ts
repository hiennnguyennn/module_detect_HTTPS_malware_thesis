
import {
  ConnectedSocket,
    MessageBody,
    SubscribeMessage,
    WebSocketGateway,
    WebSocketServer,
    WsResponse,
  } from '@nestjs/websockets';
import { Server, Socket } from 'socket.io';


  @WebSocketGateway({ cors: {
    origin: '*',
  }})
  export class EventsGateway {
    @WebSocketServer()
    server: Server;
    // socket:Socket
    constructor(
    ) {}

    async handleData(data){
      this.server.sockets.emit('events',data)
    }

    // @CacheTTL(10)
    // @CacheKey('events')
    // @UseInterceptors(CacheInterceptor)
    // @SubscribeMessage('events')
    // async listenForMessages(@MessageBody() data) {
    //   this.adminService.saveLog(data)
    //   console.log('js socket id: '+this.socketFEID)
    //   this.sockets[this.socketFEID].emit('events', {'connection index':data['connection_data']['connection_index'],'prediction':data['predict']});
    // }

    // @SubscribeMessage('logs')
    // async listenForMeLogs(@MessageBody() data) {
    //   console.log('logs: ',data.name)
    // }
    async startSlipsSocket(){
      await this.server.sockets.emit('log',{'data':'Starting detection ...........\n'})
    }
    async closeSlipsSocket(){
      await this.server.sockets.emit('log',{'data':'Stopped detection'})
      this.server.sockets.disconnectSockets(true)
    }
    // async fakeNoti(){
    //   console.log('fake notification: '+this.socketFEID)
    //   this.sockets[this.socketFEID].emit('events', {'connection index':[ '192.168.5.102', '185.21.103.31', 443, 'tcp' ],'prediction':"1"});
    // }

  }

